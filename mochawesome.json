{
  "stats": {
    "suites": 10,
    "tests": 22,
    "passes": 1,
    "pending": 0,
    "failures": 21,
    "start": "2023-11-24T16:20:10.198Z",
    "end": "2023-11-24T16:20:52.828Z",
    "duration": 42630,
    "testsRegistered": 22,
    "passPercent": 4.545454545454546,
    "pendingPercent": 0,
    "other": 0,
    "hasOther": false,
    "skipped": 0,
    "hasSkipped": false
  },
  "results": [
    {
      "uuid": "ff8f7e8f-491c-4499-b2db-b0336a3bc132",
      "title": "",
      "fullFile": "",
      "file": "",
      "beforeHooks": [],
      "afterHooks": [],
      "tests": [],
      "suites": [
        {
          "uuid": "db94715c-142b-41fd-8e1a-f23787112473",
          "title": "Cloud functions template test. Shows how to run functions against emulators",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts",
          "file": "/src/functions/cloudFunctionTemplate.test.ts",
          "beforeHooks": [
            {
              "title": "\"before all\" hook in \"Cloud functions template test. Shows how to run functions against emulators\"",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators \"before all\" hook in \"Cloud functions template test. Shows how to run functions against emulators\"",
              "timedOut": false,
              "duration": 245,
              "state": null,
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "const serviceAccountKeyFileName = './src/abonement-58b38-firebase-credentials.json';\nconst projectSettings = {\n    projectId: 'abonement-58b38',\n};\ncloudFunctionText(projectSettings, serviceAccountKeyFileName);\nadmin.firestore().settings({\n    host: 'localhost:8080',\n    ssl: false,\n    keyFilename: serviceAccountKeyFileName,\n});",
              "err": {},
              "uuid": "51b7738c-779b-4604-8eb7-7942a19f3796",
              "parentUUID": "db94715c-142b-41fd-8e1a-f23787112473",
              "isHook": true,
              "skipped": false
            }
          ],
          "afterHooks": [],
          "tests": [
            {
              "title": "should pass using database and the emulators",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators should pass using database and the emulators",
              "timedOut": true,
              "duration": 2306,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testValue = { value: 'original' };\nawait collectionService_1.db.collection('example').doc('test-doc').set(testValue);\nconst snap = await collectionService_1.db.collection('example').doc('test-doc').get();\nconst data = snap.data();\nassert.deepEqual(data, testValue);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "8b3426c9-9f2f-4e1e-a32f-e23aaec4fb1b",
              "parentUUID": "db94715c-142b-41fd-8e1a-f23787112473",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "creates a lesson and then finalizes it",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators creates a lesson and then finalizes it",
              "timedOut": true,
              "duration": 2003,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "await collectionService_1.db.collection('test_lessons').doc(exports.testLesson.id).set(exports.testLesson);\nassert.throws(async () => await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'text/plain',\n    },\n    body: exports.testLesson.id,\n}), Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(exports.testLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.done);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "98c84d61-b1b0-46d5-b497-215c2cc0eca7",
              "parentUUID": "db94715c-142b-41fd-8e1a-f23787112473",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "runs a cloud scheduled function",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators runs a cloud scheduled function",
              "timedOut": true,
              "duration": 2006,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const comingSoonLesson = Object.assign(Object.assign({}, exports.testLesson), { id: 'new-test-lisson-id', status: domain_1.LessonStatus.commingSoon });\nlessonScheduler_1.backendCollectionsCurrent.lessons.doc(exports.testLesson.id).set(comingSoonLesson);\nawait (0, lessonScheduler_1.lessonStartsUpdaterFunction)({\n    eventId: 'test-event-id',\n    timestamp: Date.now().toString(),\n    params: {},\n    eventType: 'test-event-type',\n    resource: {\n        service: 'test-service',\n        name: 'test-name',\n    },\n});\nconst snap = await lessonScheduler_1.backendCollectionsCurrent.lessons.doc(exports.testLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.finished);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "fae37256-dc03-41cd-8214-ac704c14d9e3",
              "parentUUID": "db94715c-142b-41fd-8e1a-f23787112473",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "8b3426c9-9f2f-4e1e-a32f-e23aaec4fb1b",
            "98c84d61-b1b0-46d5-b497-215c2cc0eca7",
            "fae37256-dc03-41cd-8214-ac704c14d9e3"
          ],
          "pending": [],
          "skipped": [],
          "duration": 6315,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "c63703c2-932c-4188-9f6e-95a66bdb0ec8",
          "title": "lesson finalization tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts",
          "file": "/src/functions/lessonFinalization.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "1. Can finalize lesson from finished status to done status with date cheking",
              "fullTitle": "lesson finalization tests 1. Can finalize lesson from finished status to done status with date cheking",
              "timedOut": true,
              "duration": 2003,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const finishedTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'finished-test-lisson-id', status: domain_1.LessonStatus.finished, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(finishedTestLesson.id).set(finishedTestLesson);\nawait fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'text/plain',\n    },\n    body: finishedTestLesson.id,\n});\nconst snap = await collectionService_1.db.collection('test_lessons').doc(finishedTestLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.done);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "1d97b6ed-d0f9-4fea-b15b-22b6bf50c793",
              "parentUUID": "c63703c2-932c-4188-9f6e-95a66bdb0ec8",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "2. Attempt to finalize lesson with date later then now will fail with error",
              "fullTitle": "lesson finalization tests 2. Attempt to finalize lesson with date later then now will fail with error",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const dateInFuture = new Date();\ndateInFuture.setFullYear(dateInFuture.getFullYear() + 1);\nconst testLessonFromFuture = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'future-test-lisson-id', status: domain_1.LessonStatus.finished, date: dateInFuture });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonFromFuture.id).set(testLessonFromFuture);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonFromFuture.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(testLessonFromFuture.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.finished);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "d7ff1fc4-ed6d-46aa-ad51-6690a2a186c3",
              "parentUUID": "c63703c2-932c-4188-9f6e-95a66bdb0ec8",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "3. Attempt to finalize lesson from other statuses then finished will fail with error",
              "fullTitle": "lesson finalization tests 3. Attempt to finalize lesson from other statuses then finished will fail with error",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const scheduledTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'scheduled-test-lisson-id', status: domain_1.LessonStatus.scheduled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).set(scheduledTestLesson);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: scheduledTestLesson.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.scheduled);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "968251af-39f2-4304-8e0e-caa7aba0c175",
              "parentUUID": "c63703c2-932c-4188-9f6e-95a66bdb0ec8",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "4. Accepted user abonements will be consumed after lesson finalization",
              "fullTitle": "lesson finalization tests 4. Accepted user abonements will be consumed after lesson finalization",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithAccepted = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-accepted-id', status: domain_1.LessonStatus.finished, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0, accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id',\n    ] });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithAccepted.id).set(testLessonWithAccepted);\nconst testUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst testUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst testUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonWithAccepted.id,\n    });\n}, Error);\nconst checkTestUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst checkTestUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst checkTestUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.equal(testUser1LimitLessons, checkTestUser1LimitLessons - 1);\nassert.equal(testUser2LimitLessons, checkTestUser2LimitLessons - 1);\nassert.equal(testUser3LimitLessons, checkTestUser3LimitLessons);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "cf825e75-c950-404a-b0b0-8e39ce2f50c7",
              "parentUUID": "c63703c2-932c-4188-9f6e-95a66bdb0ec8",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "5. When lesson is finalezed, teacher and students will get notification",
              "fullTitle": "lesson finalization tests 5. When lesson is finalezed, teacher and students will get notification",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithAcceptedAndTeacher = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-accepted&teacher-id', status: domain_1.LessonStatus.finished, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0, teacherId: 'test-teacher-id', accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id',\n    ] });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithAcceptedAndTeacher.id).set(testLessonWithAcceptedAndTeacher);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonWithAcceptedAndTeacher.id,\n    });\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "d2f58bbd-dc6b-4495-b09d-35cffe394c33",
              "parentUUID": "c63703c2-932c-4188-9f6e-95a66bdb0ec8",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "1d97b6ed-d0f9-4fea-b15b-22b6bf50c793",
            "d7ff1fc4-ed6d-46aa-ad51-6690a2a186c3",
            "968251af-39f2-4304-8e0e-caa7aba0c175",
            "cf825e75-c950-404a-b0b0-8e39ce2f50c7",
            "d2f58bbd-dc6b-4495-b09d-35cffe394c33"
          ],
          "pending": [],
          "skipped": [],
          "duration": 10007,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "481d8734-6414-4a73-acd5-6e8ecb483920",
          "title": " cancel Lesson Function tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts",
          "file": "/src/functions/lessonFinalization.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "1. Can cancel lesson from scheduled and coming soon status to canceled status",
              "fullTitle": " cancel Lesson Function tests 1. Can cancel lesson from scheduled and coming soon status to canceled status",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const scheduledTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'scheduled-test-lisson-id', status: domain_1.LessonStatus.scheduled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nconst commingSoonTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'coming-soon-test-lisson-id', status: domain_1.LessonStatus.commingSoon, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).set(scheduledTestLesson);\nawait collectionService_1.db.collection('test_lessons').doc(commingSoonTestLesson.id).set(commingSoonTestLesson);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/cancelLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: scheduledTestLesson.id,\n    });\n}, Error);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/cancelLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: commingSoonTestLesson.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).get();\nconst scheduledTestLessonData = snap.data();\nassert.deepEqual(scheduledTestLessonData.status, domain_1.LessonStatus.canceled);\nconst snap2 = await collectionService_1.db.collection('test_lessons').doc(commingSoonTestLesson.id).get();\nconst commingSoonTestLessonData = snap2.data();\nassert.deepEqual(commingSoonTestLessonData.status, domain_1.LessonStatus.canceled);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "a74631fd-3e1b-40ee-bd56-79ef5b773453",
              "parentUUID": "481d8734-6414-4a73-acd5-6e8ecb483920",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "2. You can not finalize canceled lesson ",
              "fullTitle": " cancel Lesson Function tests 2. You can not finalize canceled lesson ",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const canceledTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'canceled-test-lisson-id', status: domain_1.LessonStatus.canceled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(canceledTestLesson.id).set(canceledTestLesson);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: canceledTestLesson.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(canceledTestLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.canceled);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "23114b14-d4f9-4df5-8465-c82a53f5059b",
              "parentUUID": "481d8734-6414-4a73-acd5-6e8ecb483920",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "3. Both accepted and declained users abonements will not be consumed after lesson cancelation",
              "fullTitle": " cancel Lesson Function tests 3. Both accepted and declained users abonements will not be consumed after lesson cancelation",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithAccepted = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-accepted-id', status: domain_1.LessonStatus.scheduled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0, accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id',\n    ] });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithAccepted.id).set(testLessonWithAccepted);\nconst testUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst testUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst testUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/cancelLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonWithAccepted.id,\n    });\n}, Error);\nconst checkTestUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst checkTestUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst checkTestUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.equal(testUser1LimitLessons, checkTestUser1LimitLessons);\nassert.equal(testUser2LimitLessons, checkTestUser2LimitLessons);\nassert.equal(testUser3LimitLessons, checkTestUser3LimitLessons);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "453f8ed1-14d5-48c2-b129-b50efd5cb327",
              "parentUUID": "481d8734-6414-4a73-acd5-6e8ecb483920",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "a74631fd-3e1b-40ee-bd56-79ef5b773453",
            "23114b14-d4f9-4df5-8465-c82a53f5059b",
            "453f8ed1-14d5-48c2-b129-b50efd5cb327"
          ],
          "pending": [],
          "skipped": [],
          "duration": 6003,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "ab467db5-ec0c-4f44-bb4f-b31d500f4632",
          "title": "lesson Scheduler Function tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For every rule that require us to create a new lesson within lessonCreationTimeInterval the single entity of lesson is created ",
              "fullTitle": "lesson Scheduler Function tests For every rule that require us to create a new lesson within lessonCreationTimeInterval the single entity of lesson is created ",
              "timedOut": true,
              "duration": 2007,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const scheduledTestRule1 = Object.assign(Object.assign({}, exports.testRule), { id: 'scheduledTestRule1Id', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [new Date(Date.now() + lessonScheduler_1.lessonCreationTimeInterval + 100)],\n    } });\nconst scheduledTestRule2 = Object.assign(Object.assign({}, exports.testRule), { id: 'scheduledTestRule2Id', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [new Date(Date.now() - (lessonScheduler_1.lessonCreationTimeInterval - 100))],\n    } });\nconst scheduledTestRule3 = Object.assign(Object.assign({}, exports.testRule), { id: 'scheduledTestRule3Id', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [new Date(Date.now())],\n    } });\nconst testRules = [\n    scheduledTestRule1,\n    scheduledTestRule2,\n    scheduledTestRule3,\n];\nawait Promise.all(testRules.map(async (rule) => {\n    await collectionService_1.db.collection('test_rules').doc(rule.id).set(rule);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonSchedulerFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst createdLessonQuery = collectionService_1.db.collection('test_lesson').orderBy('date', 'desc').limit(1);\nconst snap = await createdLessonQuery.get();\nconst data = snap.docs[0].data();\nassert.deepEqual(data.ruleId, scheduledTestRule3.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "9e3b045c-cf57-4ce6-85e1-a030d4f14e29",
              "parentUUID": "ab467db5-ec0c-4f44-bb4f-b31d500f4632",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "When the lesson is scheduled the teacher notifications appear",
              "fullTitle": "lesson Scheduler Function tests When the lesson is scheduled the teacher notifications appear",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "await collectionService_1.db.collection('test_rules').doc(exports.testRule.id).set(exports.testRule);\nconst countNotification = await checkSendedNotifications('testTeacherId');\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonSchedulerFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst newCountNotification = await checkSendedNotifications('testTeacherId');\nassert.deepEqual(newCountNotification, countNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "63df9690-1a64-40cd-a05e-2a8c8fb264c3",
              "parentUUID": "ab467db5-ec0c-4f44-bb4f-b31d500f4632",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "9e3b045c-cf57-4ce6-85e1-a030d4f14e29",
            "63df9690-1a64-40cd-a05e-2a8c8fb264c3"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4008,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "52a41c5b-4490-4895-951f-59f2152d84cb",
          "title": "lessonComingSoonUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For every lesson that is scheduled in less then lessonComingSoonTimeInterval the status changed to commingSoon",
              "fullTitle": "lessonComingSoonUpdaterFunction tests For every lesson that is scheduled in less then lessonComingSoonTimeInterval the status changed to commingSoon",
              "timedOut": true,
              "duration": 2003,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const dateInlessonComingSoonTimeInterval = new Date(Date.now() - (lessonScheduler_1.lessonComingSoonTimeInterval - 100));\nconst dateOutlessonComingSoonTimeInterval = new Date(Date.now() - (lessonScheduler_1.lessonComingSoonTimeInterval + 100));\nconst scheduledLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.scheduled, date: dateInlessonComingSoonTimeInterval });\nconst scheduledLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.scheduled, date: dateOutlessonComingSoonTimeInterval });\nconst scheduledLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.canceled, date: dateInlessonComingSoonTimeInterval });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, date: dateInlessonComingSoonTimeInterval });\nconst finishedLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.finished, date: dateInlessonComingSoonTimeInterval });\nconst inProcessLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.inProcess, date: dateInlessonComingSoonTimeInterval });\nconst testLessons = [\n    scheduledLesson1,\n    scheduledLesson2,\n    scheduledLesson3,\n    doneLesson,\n    finishedLesson,\n    inProcessLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonComingSoonUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.commingSoon);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, scheduledLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "634c09ae-dc7e-4f93-b6bf-b46b42340859",
              "parentUUID": "52a41c5b-4490-4895-951f-59f2152d84cb",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "When the lesson is commingSoon the teacher and users notifications appear",
              "fullTitle": "lessonComingSoonUpdaterFunction tests When the lesson is commingSoon the teacher and users notifications appear",
              "timedOut": true,
              "duration": 2002,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithTeacherId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-teacher-id', status: domain_1.LessonStatus.scheduled, date: new Date(Date.now() - (lessonScheduler_1.lessonComingSoonTimeInterval - 100)), teacherId: 'test-teacher-id' });\nconst testUsers = [\n    {\n        id: 'test-user1-id',\n        name: 'test-user1-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user2-id',\n        name: 'test-user2-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user3-id',\n        name: 'test-user3-name',\n        avatar: '',\n    },\n];\nawait Promise.all(testUsers.map(async (user) => {\n    await collectionService_1.db.collection('test_users').doc(user.id).set(user);\n}));\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithTeacherId.id).set(testLessonWithTeacherId);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonComingSoonUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification + 1);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "491b3ef7-a131-4dec-a2d5-49bf19720966",
              "parentUUID": "52a41c5b-4490-4895-951f-59f2152d84cb",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "634c09ae-dc7e-4f93-b6bf-b46b42340859",
            "491b3ef7-a131-4dec-a2d5-49bf19720966"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4005,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "b41a3f54-5b2c-4ff2-96aa-5d1a00d40dcf",
          "title": "lessonStartsUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For commingSoon lessons that has date less then now and not greater then date + duration the status changed to starts",
              "fullTitle": "lessonStartsUpdaterFunction tests For commingSoon lessons that has date less then now and not greater then date + duration the status changed to starts",
              "timedOut": true,
              "duration": 2004,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const tooEarly = new Date(Date.now() - 100);\nconst startTime = new Date();\nconst tooLate = new Date(Date.now() + lessonScheduler_1.lessonComingSoonTimeInterval);\nconst commingSoonLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.commingSoon, date: startTime });\nconst commingSoonLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.commingSoon, date: tooEarly });\nconst commingSoonLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.commingSoon, date: tooLate });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, date: startTime });\nconst finishedLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.finished, date: startTime });\nconst scheduledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.scheduled, date: startTime });\nconst testLessons = [\n    commingSoonLesson1,\n    commingSoonLesson2,\n    commingSoonLesson3,\n    doneLesson,\n    finishedLesson,\n    scheduledLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonStartsUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.inProcess);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, commingSoonLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "b6c8c57e-c33e-4acb-9a3e-3253e627e019",
              "parentUUID": "b41a3f54-5b2c-4ff2-96aa-5d1a00d40dcf",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "b6c8c57e-c33e-4acb-9a3e-3253e627e019"
          ],
          "pending": [],
          "skipped": [],
          "duration": 2004,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "9d6f3ceb-e296-4e2b-b897-e40d01eea0dc",
          "title": "lessonFinishedUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For started lessons that has date + duration less then now the status changed to finished",
              "fullTitle": "lessonFinishedUpdaterFunction tests For started lessons that has date + duration less then now the status changed to finished",
              "timedOut": true,
              "duration": 2005,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const inProcessStartTime = new Date(Date.now() - (oneHourDuration - 100));\nconst finishedStartTime = new Date(Date.now() - (oneHourDuration + 100));\nconst commingSoonStartTime = new Date(Date.now() - (oneHourDuration * 2));\nconst inProcessLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.inProcess, durationMin: 60, date: finishedStartTime });\nconst inProcessLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.inProcess, date: inProcessStartTime });\nconst inProcessLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.inProcess, date: commingSoonStartTime });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, date: finishedStartTime });\nconst commingSoonLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.commingSoon, date: finishedStartTime });\nconst scheduledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.scheduled, date: finishedStartTime });\nconst testLessons = [\n    inProcessLesson1,\n    inProcessLesson2,\n    inProcessLesson3,\n    doneLesson,\n    commingSoonLesson,\n    scheduledLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonFinishedUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.finished);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, inProcessLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "e938f08e-3e68-4f19-849d-38851de85ec7",
              "parentUUID": "9d6f3ceb-e296-4e2b-b897-e40d01eea0dc",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "e938f08e-3e68-4f19-849d-38851de85ec7"
          ],
          "pending": [],
          "skipped": [],
          "duration": 2005,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "006c7dbb-061b-4a8e-a5a4-49f066afa2d8",
          "title": "lessonFinalizedUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For finished lessons that has date + duration + lessonFinalizedTimeInterval less then now the status changed to finalized",
              "fullTitle": "lessonFinalizedUpdaterFunction tests For finished lessons that has date + duration + lessonFinalizedTimeInterval less then now the status changed to finalized",
              "timedOut": true,
              "duration": 2003,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const tooEarlyFiniz = new Date(Date.now() - (oneHourDuration + lessonScheduler_1.lessonFinalizedTimeInterval - 100));\nconst finalizedTime = new Date(Date.now() - (oneHourDuration + lessonScheduler_1.lessonFinalizedTimeInterval + 100));\nconst sheduledTime = new Date(Date.now() + (oneHourDuration * 2));\nconst finishedLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.finished, durationMin: 60, date: finalizedTime });\nconst finishedLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.finished, date: tooEarlyFiniz });\nconst finishedLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.finished, date: sheduledTime });\nconst inProcessLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.inProcess, date: finalizedTime });\nconst commingSoonLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.commingSoon, date: finalizedTime });\nconst scheduledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.scheduled, date: finalizedTime });\nconst testLessons = [\n    finishedLesson1,\n    finishedLesson2,\n    finishedLesson3,\n    inProcessLesson,\n    commingSoonLesson,\n    scheduledLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonFinalizedUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.done);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, finishedLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "31c3a38e-76be-4278-98a5-f9eaba5f9c7e",
              "parentUUID": "006c7dbb-061b-4a8e-a5a4-49f066afa2d8",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "When the lesson is finalized the teacher and users notifications appear",
              "fullTitle": "lessonFinalizedUpdaterFunction tests When the lesson is finalized the teacher and users notifications appear",
              "timedOut": true,
              "duration": 2002,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithTeacherId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-teacher-id', status: domain_1.LessonStatus.finished, date: new Date(Date.now() - (oneHourDuration + lessonScheduler_1.lessonFinalizedTimeInterval + 100)), teacherId: 'test-teacher-id', accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id'\n    ] });\nconst testUsers = [\n    {\n        id: 'test-user1-id',\n        name: 'test-user1-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user2-id',\n        name: 'test-user2-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user3-id',\n        name: 'test-user3-name',\n        avatar: '',\n    },\n];\nawait Promise.all(testUsers.map(async (user) => {\n    await collectionService_1.db.collection('test_users').doc(user.id).set(user);\n}));\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithTeacherId.id).set(testLessonWithTeacherId);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonFinalizedUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "67b9b57d-e6f4-4f5a-9678-89ca77e8768f",
              "parentUUID": "006c7dbb-061b-4a8e-a5a4-49f066afa2d8",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "31c3a38e-76be-4278-98a5-f9eaba5f9c7e",
            "67b9b57d-e6f4-4f5a-9678-89ca77e8768f"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4005,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "8b2882a0-ecd4-4647-a50a-d6625cbd9ff8",
          "title": "Rule change lesson updater tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "If the rule is changed scheduled lessons are changed",
              "fullTitle": "Rule change lesson updater tests If the rule is changed scheduled lessons are changed",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const lessonUpdaterTestRule = Object.assign(Object.assign({}, exports.testRule), { id: 'lessonUpdaterTestRuleId', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0],\n    } });\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterTestRule.id).set(lessonUpdaterTestRule);\nconst scheduledLessonWithTrueRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.scheduled, ruleId: 'lessonUpdaterTestRuleId' });\nconst scheduledLessonWithoutRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.scheduled, ruleId: undefined });\nconst scheduledLessonWithFolseRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.scheduled, ruleId: 'test-rule-id' });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, ruleId: lessonUpdaterTestRule.id });\nconst finishedLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.finished, ruleId: lessonUpdaterTestRule.id });\nconst inProcessLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.inProcess, ruleId: lessonUpdaterTestRule.id });\nconst canceledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.canceled, ruleId: lessonUpdaterTestRule.id });\nconst testLessons = [\n    scheduledLessonWithTrueRuleId,\n    scheduledLessonWithoutRuleId,\n    scheduledLessonWithFolseRuleId,\n    doneLesson,\n    finishedLesson,\n    inProcessLesson,\n    canceledLesson\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nconst newDate = new Date(cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0.getTime() + lessonScheduler_1.lessonComingSoonTimeInterval);\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterTestRule.id).update({\n    periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [newDate],\n    }\n});\nassert.throws(async () => {\n    await changeRuleLessonUpdaterFunction(lessonUpdaterTestRule.id);\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.date === newDate);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, scheduledLessonWithTrueRuleId.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "ac3c4110-0615-4505-8f73-ca76105d53b6",
              "parentUUID": "8b2882a0-ecd4-4647-a50a-d6625cbd9ff8",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "If the rule is changed teacher and users notifications appear",
              "fullTitle": "Rule change lesson updater tests If the rule is changed teacher and users notifications appear",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const lessonUpdaterNotificationsTestRule = Object.assign(Object.assign({}, exports.testRule), { id: 'lessonUpdaterTestRuleId', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0],\n    } });\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterNotificationsTestRule.id).set(lessonUpdaterNotificationsTestRule);\nconst testLessonWithRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-rule-id', status: domain_1.LessonStatus.finished, teacherId: 'test-teacher-id', ruleId: lessonUpdaterNotificationsTestRule.id, accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id'\n    ] });\nconst testUsers = [\n    {\n        id: 'test-user1-id',\n        name: 'test-user1-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user2-id',\n        name: 'test-user2-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user3-id',\n        name: 'test-user3-name',\n        avatar: '',\n    },\n];\nawait Promise.all(testUsers.map(async (user) => {\n    await collectionService_1.db.collection('test_users').doc(user.id).set(user);\n}));\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithRuleId.id).set(testLessonWithRuleId);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nconst newDate = new Date(cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0.getTime() + lessonScheduler_1.lessonComingSoonTimeInterval);\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterNotificationsTestRule.id).update({\n    periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [newDate],\n    }\n});\nassert.throws(async () => {\n    await changeRuleLessonUpdaterFunction(lessonUpdaterNotificationsTestRule.id);\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "e6e2cb9f-3e76-4a11-87fc-3b74866df3cb",
              "parentUUID": "8b2882a0-ecd4-4647-a50a-d6625cbd9ff8",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "ac3c4110-0615-4505-8f73-ca76105d53b6",
            "e6e2cb9f-3e76-4a11-87fc-3b74866df3cb"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4002,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "b94b558a-c6fb-45e7-8702-96bb2dfc7a16",
          "title": "Template test case. It show if the tests are able to run",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/services/serviceTest.test.ts",
          "file": "/src/services/serviceTest.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "should pass",
              "fullTitle": "Template test case. It show if the tests are able to run should pass",
              "timedOut": false,
              "duration": 0,
              "state": "passed",
              "speed": "fast",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "assert.strictEqual(1, 1);",
              "err": {},
              "uuid": "a2683e32-907d-483e-b748-47388cd7b5f3",
              "parentUUID": "b94b558a-c6fb-45e7-8702-96bb2dfc7a16",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [
            "a2683e32-907d-483e-b748-47388cd7b5f3"
          ],
          "failures": [],
          "pending": [],
          "skipped": [],
          "duration": 0,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        }
      ],
      "passes": [],
      "failures": [],
      "pending": [],
      "skipped": [],
      "duration": 0,
      "root": true,
      "rootEmpty": true,
      "_timeout": 2000
    }
  ],
  "meta": {
    "mocha": {
      "version": "10.2.0"
    },
    "mochawesome": {
      "options": {
        "quiet": false,
        "reportFilename": "mochawesome",
        "saveHtml": true,
        "saveJson": true,
        "consoleReporter": "spec",
        "useInlineDiffs": false,
        "code": true
      },
      "version": "7.1.3"
    },
    "marge": {
      "options": null,
      "version": "6.2.0"
    }
  }
}