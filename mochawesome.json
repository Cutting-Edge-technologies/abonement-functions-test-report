{
  "stats": {
    "suites": 10,
    "tests": 22,
    "passes": 1,
    "pending": 0,
    "failures": 21,
    "start": "2023-11-17T15:00:17.783Z",
    "end": "2023-11-17T15:01:00.255Z",
    "duration": 42472,
    "testsRegistered": 22,
    "passPercent": 4.545454545454546,
    "pendingPercent": 0,
    "other": 0,
    "hasOther": false,
    "skipped": 0,
    "hasSkipped": false
  },
  "results": [
    {
      "uuid": "30eed714-4c64-4980-90c6-29bfe98e0c93",
      "title": "",
      "fullFile": "",
      "file": "",
      "beforeHooks": [],
      "afterHooks": [],
      "tests": [],
      "suites": [
        {
          "uuid": "157b9335-5d27-4334-985b-215da288fef7",
          "title": "Cloud functions template test. Shows how to run functions against emulators",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts",
          "file": "/src/functions/cloudFunctionTemplate.test.ts",
          "beforeHooks": [
            {
              "title": "\"before all\" hook in \"Cloud functions template test. Shows how to run functions against emulators\"",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators \"before all\" hook in \"Cloud functions template test. Shows how to run functions against emulators\"",
              "timedOut": false,
              "duration": 179,
              "state": null,
              "speed": null,
              "pass": false,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "const serviceAccountKeyFileName = './src/abonement-58b38-firebase-credentials.json';\nconst projectSettings = {\n    projectId: 'abonement-58b38',\n};\ncloudFunctionText(projectSettings, serviceAccountKeyFileName);\nadmin.firestore().settings({\n    host: 'localhost:8080',\n    ssl: false,\n    keyFilename: serviceAccountKeyFileName,\n});",
              "err": {},
              "uuid": "16e6a3ae-d48f-4d64-9e28-ad52926be45f",
              "parentUUID": "157b9335-5d27-4334-985b-215da288fef7",
              "isHook": true,
              "skipped": false
            }
          ],
          "afterHooks": [],
          "tests": [
            {
              "title": "should pass using database and the emulators",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators should pass using database and the emulators",
              "timedOut": true,
              "duration": 2225,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testValue = { value: 'original' };\nawait collectionService_1.db.collection('example').doc('test-doc').set(testValue);\nconst snap = await collectionService_1.db.collection('example').doc('test-doc').get();\nconst data = snap.data();\nassert.deepEqual(data, testValue);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "b69c74e2-6e1d-42c4-b8ae-189427df63dc",
              "parentUUID": "157b9335-5d27-4334-985b-215da288fef7",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "creates a lesson and then finalizes it",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators creates a lesson and then finalizes it",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "await collectionService_1.db.collection('test_lessons').doc(exports.testLesson.id).set(exports.testLesson);\nassert.throws(async () => await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'text/plain',\n    },\n    body: exports.testLesson.id,\n}), Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(exports.testLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.done);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "8abc0cd0-442f-4a2b-ad97-6efd728b8054",
              "parentUUID": "157b9335-5d27-4334-985b-215da288fef7",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "runs a cloud scheduled function",
              "fullTitle": "Cloud functions template test. Shows how to run functions against emulators runs a cloud scheduled function",
              "timedOut": true,
              "duration": 2005,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const comingSoonLesson = Object.assign(Object.assign({}, exports.testLesson), { id: 'new-test-lisson-id', status: domain_1.LessonStatus.commingSoon });\nlessonScheduler_1.backendCollectionsCurrent.lessons.doc(exports.testLesson.id).set(comingSoonLesson);\nawait (0, lessonScheduler_1.lessonStartsUpdaterFunction)({\n    eventId: 'test-event-id',\n    timestamp: Date.now().toString(),\n    params: {},\n    eventType: 'test-event-type',\n    resource: {\n        service: 'test-service',\n        name: 'test-name',\n    },\n});\nconst snap = await lessonScheduler_1.backendCollectionsCurrent.lessons.doc(exports.testLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.finished);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/cloudFunctionTemplate.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "5e7a7b00-71e1-474d-bb42-3632f3b5397e",
              "parentUUID": "157b9335-5d27-4334-985b-215da288fef7",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "b69c74e2-6e1d-42c4-b8ae-189427df63dc",
            "8abc0cd0-442f-4a2b-ad97-6efd728b8054",
            "5e7a7b00-71e1-474d-bb42-3632f3b5397e"
          ],
          "pending": [],
          "skipped": [],
          "duration": 6231,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "2c5f28fe-a6d3-4f78-bb6c-2ec79a833f55",
          "title": "lesson finalization tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts",
          "file": "/src/functions/lessonFinalization.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "1. Can finalize lesson from finished status to done status with date cheking",
              "fullTitle": "lesson finalization tests 1. Can finalize lesson from finished status to done status with date cheking",
              "timedOut": true,
              "duration": 2003,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const finishedTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'finished-test-lisson-id', status: domain_1.LessonStatus.finished, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(finishedTestLesson.id).set(finishedTestLesson);\nawait fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'text/plain',\n    },\n    body: finishedTestLesson.id,\n});\nconst snap = await collectionService_1.db.collection('test_lessons').doc(finishedTestLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.done);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "f393d5fb-d838-494d-bba0-573bca3fa503",
              "parentUUID": "2c5f28fe-a6d3-4f78-bb6c-2ec79a833f55",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "2. Attempt to finalize lesson with date later then now will fail with error",
              "fullTitle": "lesson finalization tests 2. Attempt to finalize lesson with date later then now will fail with error",
              "timedOut": true,
              "duration": 2000,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const dateInFuture = new Date();\ndateInFuture.setFullYear(dateInFuture.getFullYear() + 1);\nconst testLessonFromFuture = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'future-test-lisson-id', status: domain_1.LessonStatus.finished, date: dateInFuture });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonFromFuture.id).set(testLessonFromFuture);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonFromFuture.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(testLessonFromFuture.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.finished);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "ce505485-d23a-41d9-82c5-4bce1dd6c759",
              "parentUUID": "2c5f28fe-a6d3-4f78-bb6c-2ec79a833f55",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "3. Attempt to finalize lesson from other statuses then finished will fail with error",
              "fullTitle": "lesson finalization tests 3. Attempt to finalize lesson from other statuses then finished will fail with error",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const scheduledTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'scheduled-test-lisson-id', status: domain_1.LessonStatus.scheduled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).set(scheduledTestLesson);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: scheduledTestLesson.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.scheduled);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "d69ea711-2cb7-49d4-84a4-ae98db9976e4",
              "parentUUID": "2c5f28fe-a6d3-4f78-bb6c-2ec79a833f55",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "4. Accepted user abonements will be consumed after lesson finalization",
              "fullTitle": "lesson finalization tests 4. Accepted user abonements will be consumed after lesson finalization",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithAccepted = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-accepted-id', status: domain_1.LessonStatus.finished, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0, accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id',\n    ] });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithAccepted.id).set(testLessonWithAccepted);\nconst testUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst testUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst testUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonWithAccepted.id,\n    });\n}, Error);\nconst checkTestUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst checkTestUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst checkTestUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.equal(testUser1LimitLessons, checkTestUser1LimitLessons - 1);\nassert.equal(testUser2LimitLessons, checkTestUser2LimitLessons - 1);\nassert.equal(testUser3LimitLessons, checkTestUser3LimitLessons);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "4d0945bb-93c5-4b94-a668-6ccb6031f8a6",
              "parentUUID": "2c5f28fe-a6d3-4f78-bb6c-2ec79a833f55",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "5. When lesson is finalezed, teacher and students will get notification",
              "fullTitle": "lesson finalization tests 5. When lesson is finalezed, teacher and students will get notification",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithAcceptedAndTeacher = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-accepted&teacher-id', status: domain_1.LessonStatus.finished, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0, teacherId: 'test-teacher-id', accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id',\n    ] });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithAcceptedAndTeacher.id).set(testLessonWithAcceptedAndTeacher);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonWithAcceptedAndTeacher.id,\n    });\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "e0c3eb1d-5444-4dee-8e1d-65de3eb21eb4",
              "parentUUID": "2c5f28fe-a6d3-4f78-bb6c-2ec79a833f55",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "f393d5fb-d838-494d-bba0-573bca3fa503",
            "ce505485-d23a-41d9-82c5-4bce1dd6c759",
            "d69ea711-2cb7-49d4-84a4-ae98db9976e4",
            "4d0945bb-93c5-4b94-a668-6ccb6031f8a6",
            "e0c3eb1d-5444-4dee-8e1d-65de3eb21eb4"
          ],
          "pending": [],
          "skipped": [],
          "duration": 10006,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "5448ac9b-d818-4e69-b4cd-d488df47f78d",
          "title": " cancel Lesson Function tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts",
          "file": "/src/functions/lessonFinalization.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "1. Can cancel lesson from scheduled and coming soon status to canceled status",
              "fullTitle": " cancel Lesson Function tests 1. Can cancel lesson from scheduled and coming soon status to canceled status",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const scheduledTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'scheduled-test-lisson-id', status: domain_1.LessonStatus.scheduled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nconst commingSoonTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'coming-soon-test-lisson-id', status: domain_1.LessonStatus.commingSoon, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).set(scheduledTestLesson);\nawait collectionService_1.db.collection('test_lessons').doc(commingSoonTestLesson.id).set(commingSoonTestLesson);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/cancelLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: scheduledTestLesson.id,\n    });\n}, Error);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/cancelLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: commingSoonTestLesson.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(scheduledTestLesson.id).get();\nconst scheduledTestLessonData = snap.data();\nassert.deepEqual(scheduledTestLessonData.status, domain_1.LessonStatus.canceled);\nconst snap2 = await collectionService_1.db.collection('test_lessons').doc(commingSoonTestLesson.id).get();\nconst commingSoonTestLessonData = snap2.data();\nassert.deepEqual(commingSoonTestLessonData.status, domain_1.LessonStatus.canceled);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "35e8f4ea-07d8-4598-88fa-45780b7f6410",
              "parentUUID": "5448ac9b-d818-4e69-b4cd-d488df47f78d",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "2. You can not finalize canceled lesson ",
              "fullTitle": " cancel Lesson Function tests 2. You can not finalize canceled lesson ",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const canceledTestLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'canceled-test-lisson-id', status: domain_1.LessonStatus.canceled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0 });\nawait collectionService_1.db.collection('test_lessons').doc(canceledTestLesson.id).set(canceledTestLesson);\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/finalizeLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: canceledTestLesson.id,\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').doc(canceledTestLesson.id).get();\nconst data = snap.data();\nassert.deepEqual(data.status, domain_1.LessonStatus.canceled);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "f9571ed7-4d48-49b2-9b64-07b7071dffa7",
              "parentUUID": "5448ac9b-d818-4e69-b4cd-d488df47f78d",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "3. Both accepted and declained users abonements will not be consumed after lesson cancelation",
              "fullTitle": " cancel Lesson Function tests 3. Both accepted and declained users abonements will not be consumed after lesson cancelation",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithAccepted = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-accepted-id', status: domain_1.LessonStatus.scheduled, date: cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0, accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id',\n    ] });\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithAccepted.id).set(testLessonWithAccepted);\nconst testUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst testUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst testUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.throws(async () => {\n    await fetch.default('http://127.0.0.1:5001/abonement-58b38/us-central1/cancelLesson', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'text/plain',\n        },\n        body: testLessonWithAccepted.id,\n    });\n}, Error);\nconst checkTestUser1LimitLessons = await chekAbonementLimitFunction('test-user1-id');\nconst checkTestUser2LimitLessons = await chekAbonementLimitFunction('test-user2-id');\nconst checkTestUser3LimitLessons = await chekAbonementLimitFunction('test-user3-id');\nassert.equal(testUser1LimitLessons, checkTestUser1LimitLessons);\nassert.equal(testUser2LimitLessons, checkTestUser2LimitLessons);\nassert.equal(testUser3LimitLessons, checkTestUser3LimitLessons);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonFinalization.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "8e842b5d-941d-49b7-9afa-1be916a3a3b4",
              "parentUUID": "5448ac9b-d818-4e69-b4cd-d488df47f78d",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "35e8f4ea-07d8-4598-88fa-45780b7f6410",
            "f9571ed7-4d48-49b2-9b64-07b7071dffa7",
            "8e842b5d-941d-49b7-9afa-1be916a3a3b4"
          ],
          "pending": [],
          "skipped": [],
          "duration": 6003,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "357459c6-4989-4553-b717-9e5d923246f4",
          "title": "lesson Scheduler Function tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For every rule that require us to create a new lesson within lessonCreationTimeInterval the single entity of lesson is created ",
              "fullTitle": "lesson Scheduler Function tests For every rule that require us to create a new lesson within lessonCreationTimeInterval the single entity of lesson is created ",
              "timedOut": true,
              "duration": 2005,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const scheduledTestRule1 = Object.assign(Object.assign({}, exports.testRule), { id: 'scheduledTestRule1Id', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [new Date(Date.now() + lessonScheduler_1.lessonCreationTimeInterval + 100)],\n    } });\nconst scheduledTestRule2 = Object.assign(Object.assign({}, exports.testRule), { id: 'scheduledTestRule2Id', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [new Date(Date.now() - (lessonScheduler_1.lessonCreationTimeInterval - 100))],\n    } });\nconst scheduledTestRule3 = Object.assign(Object.assign({}, exports.testRule), { id: 'scheduledTestRule3Id', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [new Date(Date.now())],\n    } });\nconst testRules = [\n    scheduledTestRule1,\n    scheduledTestRule2,\n    scheduledTestRule3,\n];\nawait Promise.all(testRules.map(async (rule) => {\n    await collectionService_1.db.collection('test_rules').doc(rule.id).set(rule);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonSchedulerFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst createdLessonQuery = collectionService_1.db.collection('test_lesson').orderBy('date', 'desc').limit(1);\nconst snap = await createdLessonQuery.get();\nconst data = snap.docs[0].data();\nassert.deepEqual(data.ruleId, scheduledTestRule3.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "904c346a-397e-4e52-8d95-5ce5053eb291",
              "parentUUID": "357459c6-4989-4553-b717-9e5d923246f4",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "When the lesson is scheduled the teacher notifications appear",
              "fullTitle": "lesson Scheduler Function tests When the lesson is scheduled the teacher notifications appear",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "await collectionService_1.db.collection('test_rules').doc(exports.testRule.id).set(exports.testRule);\nconst countNotification = await checkSendedNotifications('testTeacherId');\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonSchedulerFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst newCountNotification = await checkSendedNotifications('testTeacherId');\nassert.deepEqual(newCountNotification, countNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "533b49d4-1bff-475e-a662-f64d538c15b0",
              "parentUUID": "357459c6-4989-4553-b717-9e5d923246f4",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "904c346a-397e-4e52-8d95-5ce5053eb291",
            "533b49d4-1bff-475e-a662-f64d538c15b0"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4006,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "5dd69899-fc8c-487f-ae07-678a03bc43bd",
          "title": "lessonComingSoonUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For every lesson that is scheduled in less then lessonComingSoonTimeInterval the status changed to commingSoon",
              "fullTitle": "lessonComingSoonUpdaterFunction tests For every lesson that is scheduled in less then lessonComingSoonTimeInterval the status changed to commingSoon",
              "timedOut": true,
              "duration": 2003,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const dateInlessonComingSoonTimeInterval = new Date(Date.now() - (lessonScheduler_1.lessonComingSoonTimeInterval - 100));\nconst dateOutlessonComingSoonTimeInterval = new Date(Date.now() - (lessonScheduler_1.lessonComingSoonTimeInterval + 100));\nconst scheduledLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.scheduled, date: dateInlessonComingSoonTimeInterval });\nconst scheduledLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.scheduled, date: dateOutlessonComingSoonTimeInterval });\nconst scheduledLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.canceled, date: dateInlessonComingSoonTimeInterval });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, date: dateInlessonComingSoonTimeInterval });\nconst finishedLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.finished, date: dateInlessonComingSoonTimeInterval });\nconst inProcessLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.inProcess, date: dateInlessonComingSoonTimeInterval });\nconst testLessons = [\n    scheduledLesson1,\n    scheduledLesson2,\n    scheduledLesson3,\n    doneLesson,\n    finishedLesson,\n    inProcessLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonComingSoonUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.commingSoon);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, scheduledLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "a6578585-0773-4580-8282-cd5b340ea0bb",
              "parentUUID": "5dd69899-fc8c-487f-ae07-678a03bc43bd",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "When the lesson is commingSoon the teacher and users notifications appear",
              "fullTitle": "lessonComingSoonUpdaterFunction tests When the lesson is commingSoon the teacher and users notifications appear",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithTeacherId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-teacher-id', status: domain_1.LessonStatus.scheduled, date: new Date(Date.now() - (lessonScheduler_1.lessonComingSoonTimeInterval - 100)), teacherId: 'test-teacher-id' });\nconst testUsers = [\n    {\n        id: 'test-user1-id',\n        name: 'test-user1-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user2-id',\n        name: 'test-user2-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user3-id',\n        name: 'test-user3-name',\n        avatar: '',\n    },\n];\nawait Promise.all(testUsers.map(async (user) => {\n    await collectionService_1.db.collection('test_users').doc(user.id).set(user);\n}));\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithTeacherId.id).set(testLessonWithTeacherId);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonComingSoonUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification + 1);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "6b6bc17c-0be4-4e61-89b9-dc387da6aef6",
              "parentUUID": "5dd69899-fc8c-487f-ae07-678a03bc43bd",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "a6578585-0773-4580-8282-cd5b340ea0bb",
            "6b6bc17c-0be4-4e61-89b9-dc387da6aef6"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4004,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "8d050b2c-f407-4671-9573-267efdb9ba78",
          "title": "lessonStartsUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For commingSoon lessons that has date less then now and not greater then date + duration the status changed to starts",
              "fullTitle": "lessonStartsUpdaterFunction tests For commingSoon lessons that has date less then now and not greater then date + duration the status changed to starts",
              "timedOut": true,
              "duration": 2004,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const tooEarly = new Date(Date.now() - 100);\nconst startTime = new Date();\nconst tooLate = new Date(Date.now() + lessonScheduler_1.lessonComingSoonTimeInterval);\nconst commingSoonLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.commingSoon, date: startTime });\nconst commingSoonLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.commingSoon, date: tooEarly });\nconst commingSoonLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.commingSoon, date: tooLate });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, date: startTime });\nconst finishedLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.finished, date: startTime });\nconst scheduledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.scheduled, date: startTime });\nconst testLessons = [\n    commingSoonLesson1,\n    commingSoonLesson2,\n    commingSoonLesson3,\n    doneLesson,\n    finishedLesson,\n    scheduledLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonStartsUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.inProcess);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, commingSoonLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "4f58417d-ce8e-4e10-83d0-d5ad67dabcdf",
              "parentUUID": "8d050b2c-f407-4671-9573-267efdb9ba78",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "4f58417d-ce8e-4e10-83d0-d5ad67dabcdf"
          ],
          "pending": [],
          "skipped": [],
          "duration": 2004,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "be9a264a-ff50-469b-85c0-2024db10cc8d",
          "title": "lessonFinishedUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For started lessons that has date + duration less then now the status changed to finished",
              "fullTitle": "lessonFinishedUpdaterFunction tests For started lessons that has date + duration less then now the status changed to finished",
              "timedOut": true,
              "duration": 2005,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const inProcessStartTime = new Date(Date.now() - (oneHourDuration - 100));\nconst finishedStartTime = new Date(Date.now() - (oneHourDuration + 100));\nconst commingSoonStartTime = new Date(Date.now() - (oneHourDuration * 2));\nconst inProcessLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.inProcess, durationMin: 60, date: finishedStartTime });\nconst inProcessLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.inProcess, date: inProcessStartTime });\nconst inProcessLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.inProcess, date: commingSoonStartTime });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, date: finishedStartTime });\nconst commingSoonLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.commingSoon, date: finishedStartTime });\nconst scheduledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.scheduled, date: finishedStartTime });\nconst testLessons = [\n    inProcessLesson1,\n    inProcessLesson2,\n    inProcessLesson3,\n    doneLesson,\n    commingSoonLesson,\n    scheduledLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonFinishedUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.finished);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, inProcessLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "140924be-0746-4438-a3cf-c8023051160f",
              "parentUUID": "be9a264a-ff50-469b-85c0-2024db10cc8d",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "140924be-0746-4438-a3cf-c8023051160f"
          ],
          "pending": [],
          "skipped": [],
          "duration": 2005,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "59d568e8-4aa7-4879-8b5f-ea097673b4e5",
          "title": "lessonFinalizedUpdaterFunction tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "For finished lessons that has date + duration + lessonFinalizedTimeInterval less then now the status changed to finalized",
              "fullTitle": "lessonFinalizedUpdaterFunction tests For finished lessons that has date + duration + lessonFinalizedTimeInterval less then now the status changed to finalized",
              "timedOut": true,
              "duration": 2002,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const tooEarlyFiniz = new Date(Date.now() - (oneHourDuration + lessonScheduler_1.lessonFinalizedTimeInterval - 100));\nconst finalizedTime = new Date(Date.now() - (oneHourDuration + lessonScheduler_1.lessonFinalizedTimeInterval + 100));\nconst sheduledTime = new Date(Date.now() + (oneHourDuration * 2));\nconst finishedLesson1 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.finished, durationMin: 60, date: finalizedTime });\nconst finishedLesson2 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.finished, date: tooEarlyFiniz });\nconst finishedLesson3 = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.finished, date: sheduledTime });\nconst inProcessLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.inProcess, date: finalizedTime });\nconst commingSoonLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.commingSoon, date: finalizedTime });\nconst scheduledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.scheduled, date: finalizedTime });\nconst testLessons = [\n    finishedLesson1,\n    finishedLesson2,\n    finishedLesson3,\n    inProcessLesson,\n    commingSoonLesson,\n    scheduledLesson,\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonFinalizedUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.status === domain_1.LessonStatus.done);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, finishedLesson1.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "61a88dab-d12b-4398-835a-c95f10664d9e",
              "parentUUID": "59d568e8-4aa7-4879-8b5f-ea097673b4e5",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "When the lesson is finalized the teacher and users notifications appear",
              "fullTitle": "lessonFinalizedUpdaterFunction tests When the lesson is finalized the teacher and users notifications appear",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const testLessonWithTeacherId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-teacher-id', status: domain_1.LessonStatus.finished, date: new Date(Date.now() - (oneHourDuration + lessonScheduler_1.lessonFinalizedTimeInterval + 100)), teacherId: 'test-teacher-id', accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id'\n    ] });\nconst testUsers = [\n    {\n        id: 'test-user1-id',\n        name: 'test-user1-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user2-id',\n        name: 'test-user2-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user3-id',\n        name: 'test-user3-name',\n        avatar: '',\n    },\n];\nawait Promise.all(testUsers.map(async (user) => {\n    await collectionService_1.db.collection('test_users').doc(user.id).set(user);\n}));\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithTeacherId.id).set(testLessonWithTeacherId);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.throws(async () => {\n    await (0, lessonScheduler_1.lessonFinalizedUpdaterFunction)({\n        eventId: 'test-event-id',\n        timestamp: Date.now().toString(),\n        params: {},\n        eventType: 'test-event-type',\n        resource: {\n            service: 'test-service',\n            name: 'test-name',\n        },\n    });\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "374b1e05-af00-4d38-aeee-3fba89b3574d",
              "parentUUID": "59d568e8-4aa7-4879-8b5f-ea097673b4e5",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "61a88dab-d12b-4398-835a-c95f10664d9e",
            "374b1e05-af00-4d38-aeee-3fba89b3574d"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4003,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "ac2415bd-c080-423c-8e35-621114f349a1",
          "title": "Rule change lesson updater tests",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts",
          "file": "/src/functions/lessonScheduler.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "If the rule is changed scheduled lessons are changed",
              "fullTitle": "Rule change lesson updater tests If the rule is changed scheduled lessons are changed",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const lessonUpdaterTestRule = Object.assign(Object.assign({}, exports.testRule), { id: 'lessonUpdaterTestRuleId', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0],\n    } });\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterTestRule.id).set(lessonUpdaterTestRule);\nconst scheduledLessonWithTrueRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson1-id', status: domain_1.LessonStatus.scheduled, ruleId: 'lessonUpdaterTestRuleId' });\nconst scheduledLessonWithoutRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson2-id', status: domain_1.LessonStatus.scheduled, ruleId: undefined });\nconst scheduledLessonWithFolseRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson3-id', status: domain_1.LessonStatus.scheduled, ruleId: 'test-rule-id' });\nconst doneLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson4-id', status: domain_1.LessonStatus.done, ruleId: lessonUpdaterTestRule.id });\nconst finishedLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson5-id', status: domain_1.LessonStatus.finished, ruleId: lessonUpdaterTestRule.id });\nconst inProcessLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.inProcess, ruleId: lessonUpdaterTestRule.id });\nconst canceledLesson = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson6-id', status: domain_1.LessonStatus.canceled, ruleId: lessonUpdaterTestRule.id });\nconst testLessons = [\n    scheduledLessonWithTrueRuleId,\n    scheduledLessonWithoutRuleId,\n    scheduledLessonWithFolseRuleId,\n    doneLesson,\n    finishedLesson,\n    inProcessLesson,\n    canceledLesson\n];\nawait Promise.all(testLessons.map(async (lesson) => {\n    await collectionService_1.db.collection('test_lessons').doc(lesson.id).set(lesson);\n}));\nconst newDate = new Date(cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0.getTime() + lessonScheduler_1.lessonComingSoonTimeInterval);\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterTestRule.id).update({\n    periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [newDate],\n    }\n});\nassert.throws(async () => {\n    await changeRuleLessonUpdaterFunction(lessonUpdaterTestRule.id);\n}, Error);\nconst snap = await collectionService_1.db.collection('test_lessons').get();\nconst data = snap.docs.map((doc) => doc.data());\nconst checkLesson = data.filter((lesson) => lesson.date === newDate);\nassert.deepEqual(checkLesson.length, 1);\nassert.equal(checkLesson[0].id, scheduledLessonWithTrueRuleId.id);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "d059e772-7169-4288-a711-e4def2c0f1a4",
              "parentUUID": "ac2415bd-c080-423c-8e35-621114f349a1",
              "isHook": false,
              "skipped": false
            },
            {
              "title": "If the rule is changed teacher and users notifications appear",
              "fullTitle": "Rule change lesson updater tests If the rule is changed teacher and users notifications appear",
              "timedOut": true,
              "duration": 2001,
              "state": "failed",
              "speed": null,
              "pass": false,
              "fail": true,
              "pending": false,
              "context": null,
              "code": "const lessonUpdaterNotificationsTestRule = Object.assign(Object.assign({}, exports.testRule), { id: 'lessonUpdaterTestRuleId', periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0],\n    } });\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterNotificationsTestRule.id).set(lessonUpdaterNotificationsTestRule);\nconst testLessonWithRuleId = Object.assign(Object.assign({}, cloudFunctionTemplate_test_1.testLesson), { id: 'test-lisson-with-rule-id', status: domain_1.LessonStatus.finished, teacherId: 'test-teacher-id', ruleId: lessonUpdaterNotificationsTestRule.id, accepted: [\n        'test-user1-id',\n        'test-user2-id',\n    ], declained: [\n        'test-user3-id'\n    ] });\nconst testUsers = [\n    {\n        id: 'test-user1-id',\n        name: 'test-user1-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user2-id',\n        name: 'test-user2-name',\n        avatar: '',\n    },\n    {\n        id: 'test-user3-id',\n        name: 'test-user3-name',\n        avatar: '',\n    },\n];\nawait Promise.all(testUsers.map(async (user) => {\n    await collectionService_1.db.collection('test_users').doc(user.id).set(user);\n}));\nawait collectionService_1.db.collection('test_lessons').doc(testLessonWithRuleId.id).set(testLessonWithRuleId);\nconst testUser1Notification = await checkSendedNotifications('test-user1-id');\nconst testUser2Notification = await checkSendedNotifications('test-user2-id');\nconst testUser3Notification = await checkSendedNotifications('test-user3-id');\nconst testTeacherNotification = await checkSendedNotifications('test-teacher-id');\nconst newDate = new Date(cloudFunctionTemplate_test_1.mochDate2023_7_14_15_30_0.getTime() + lessonScheduler_1.lessonComingSoonTimeInterval);\nawait collectionService_1.db.collection('test_rules').doc(lessonUpdaterNotificationsTestRule.id).update({\n    periodicity: {\n        periodicityType: domain_1.PeriodicityType.manualDate,\n        periodicityRule: [newDate],\n    }\n});\nassert.throws(async () => {\n    await changeRuleLessonUpdaterFunction(lessonUpdaterNotificationsTestRule.id);\n}, Error);\nconst checkTestUser1Notification = await checkSendedNotifications('test-user1-id');\nconst checkTestUser2Notification = await checkSendedNotifications('test-user2-id');\nconst checkTestUser3Notification = await checkSendedNotifications('test-user3-id');\nconst checkTestTeacherNotification = await checkSendedNotifications('test-teacher-id');\nassert.equal(testUser1Notification, checkTestUser1Notification + 1);\nassert.equal(testUser2Notification, checkTestUser2Notification + 1);\nassert.equal(testUser3Notification, checkTestUser3Notification);\nassert.equal(testTeacherNotification, checkTestTeacherNotification + 1);",
              "err": {
                "message": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)",
                "estack": "Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/runner/work/abonement/abonement/functions/src/functions/lessonScheduler.test.ts)\n    at listOnTimeout (node:internal/timers:559:17)\n    at processTimers (node:internal/timers:502:7)",
                "diff": null
              },
              "uuid": "7dc56358-01bd-445c-87b2-1f510894b17d",
              "parentUUID": "ac2415bd-c080-423c-8e35-621114f349a1",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [],
          "failures": [
            "d059e772-7169-4288-a711-e4def2c0f1a4",
            "7dc56358-01bd-445c-87b2-1f510894b17d"
          ],
          "pending": [],
          "skipped": [],
          "duration": 4002,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        },
        {
          "uuid": "fac3d6c6-55aa-4bdb-91eb-9169fab82f24",
          "title": "Template test case. It show if the tests are able to run",
          "fullFile": "/home/runner/work/abonement/abonement/functions/src/services/serviceTest.test.ts",
          "file": "/src/services/serviceTest.test.ts",
          "beforeHooks": [],
          "afterHooks": [],
          "tests": [
            {
              "title": "should pass",
              "fullTitle": "Template test case. It show if the tests are able to run should pass",
              "timedOut": false,
              "duration": 0,
              "state": "passed",
              "speed": "fast",
              "pass": true,
              "fail": false,
              "pending": false,
              "context": null,
              "code": "assert.strictEqual(1, 1);",
              "err": {},
              "uuid": "bf2ed1b8-417a-491d-a359-051aa99ba80f",
              "parentUUID": "fac3d6c6-55aa-4bdb-91eb-9169fab82f24",
              "isHook": false,
              "skipped": false
            }
          ],
          "suites": [],
          "passes": [
            "bf2ed1b8-417a-491d-a359-051aa99ba80f"
          ],
          "failures": [],
          "pending": [],
          "skipped": [],
          "duration": 0,
          "root": false,
          "rootEmpty": false,
          "_timeout": 2000
        }
      ],
      "passes": [],
      "failures": [],
      "pending": [],
      "skipped": [],
      "duration": 0,
      "root": true,
      "rootEmpty": true,
      "_timeout": 2000
    }
  ],
  "meta": {
    "mocha": {
      "version": "10.2.0"
    },
    "mochawesome": {
      "options": {
        "quiet": false,
        "reportFilename": "mochawesome",
        "saveHtml": true,
        "saveJson": true,
        "consoleReporter": "spec",
        "useInlineDiffs": false,
        "code": true
      },
      "version": "7.1.3"
    },
    "marge": {
      "options": null,
      "version": "6.2.0"
    }
  }
}